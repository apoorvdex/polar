"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Preconditions_1 = require("../Preconditions");
const Reactor_1 = require("../reactor/Reactor");
class WebRequestReactor {
    constructor(webRequest) {
        this.started = false;
        this.webRequest = webRequest;
        this.reactor = new Reactor_1.Reactor();
        this.started = false;
    }
    start() {
        this.webRequest.onBeforeRedirect(this.handleBeforeRedirect.bind(this));
        this.webRequest.onBeforeRequest(this.handleBeforeRequest.bind(this));
        this.webRequest.onBeforeSendHeaders(this.handleBeforeSendHeaders.bind(this));
        this.webRequest.onCompleted(this.handleCompleted.bind(this));
        this.webRequest.onErrorOccurred(this.handleErrorOccurred.bind(this));
        this.webRequest.onResponseStarted(this.handleResponseStarted.bind(this));
        this.webRequest.onSendHeaders(this.handleSendHeaders.bind(this));
        const eventNames = [
            "onBeforeRedirect",
            "onBeforeRequest",
            "onBeforeSendHeaders",
            "onCompleted",
            "onErrorOccurred",
            "onResponseStarted",
            "onSendHeaders",
        ];
        eventNames.forEach((eventName) => {
            this.reactor.registerEvent(eventName);
        });
        this.started = true;
    }
    stop() {
        this.started = false;
        this.webRequest.onBeforeRedirect(null);
        this.webRequest.onBeforeRequest(null);
        this.webRequest.onBeforeSendHeaders(null);
        this.webRequest.onCompleted(null);
        this.webRequest.onErrorOccurred(null);
        this.webRequest.onResponseStarted(null);
        this.webRequest.onSendHeaders(null);
    }
    register(callback) {
        Preconditions_1.Preconditions.assertNotNull(callback, "callback");
        if (!this.started) {
            throw new Error("Not started!");
        }
        this.reactor.eventNames().forEach((eventName) => {
            this.reactor.addEventListener(eventName, callback);
        });
    }
    handleBeforeRequest(details, callback) {
        this.handleEvent({
            name: 'onBeforeRequest',
            details,
            callback,
        });
    }
    handleBeforeSendHeaders(details, callback) {
        this.handleEvent({
            name: 'onBeforeSendHeaders',
            details,
            callback,
        });
    }
    handleBeforeRedirect(details) {
        this.handleEvent({
            name: 'onBeforeRedirect',
            details,
        });
    }
    handleCompleted(details) {
        this.handleEvent({
            name: 'onCompleted',
            details,
        });
    }
    handleErrorOccurred(details) {
        this.handleEvent({
            name: 'onErrorOccurred',
            details,
        });
    }
    handleResponseStarted(details) {
        this.handleEvent({
            name: 'onResponseStarted',
            details,
        });
    }
    handleSendHeaders(details) {
        this.handleEvent({
            name: 'onSendHeaders',
            details,
        });
    }
    handleEvent(event, callback) {
        if (!this.started) {
            if (callback) {
                callback({ cancel: false });
            }
            return;
        }
        this.reactor.dispatchEvent(event.name, event);
    }
}
exports.WebRequestReactor = WebRequestReactor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViUmVxdWVzdFJlYWN0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJXZWJSZXF1ZXN0UmVhY3Rvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLG9EQUErQztBQUMvQyxnREFBMkM7QUFTM0MsTUFBYSxpQkFBaUI7SUFRMUIsWUFBWSxVQUFzQjtRQUYzQixZQUFPLEdBQUcsS0FBSyxDQUFDO1FBR25CLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxpQkFBTyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7SUFDekIsQ0FBQztJQUtNLEtBQUs7UUFFUixJQUFJLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDckUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDN0UsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM3RCxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDckUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDekUsSUFBSSxDQUFDLFVBQVUsQ0FB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QUFDLFdBQVcsQ0FBQztZQUNiLElBQUksRUFBRSxlQUFlO1lBQ3JCLE9BQU87U0FDVixDQUFDLENBQUM7SUFFUCxDQUFDO0lBRU8sV0FBVyxDQUFDLEtBQTRCLEVBQUUsUUFBZ0Q7UUFFOUYsSUFBSSxDQUFFLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFFaEIsSUFBSSxRQUFRLEVBQUU7Z0JBQ1YsUUFBUSxDQUFDLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7YUFDN0I7WUFFRCxPQUFPO1NBQ1Y7UUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRWxELENBQUM7Q0FFSjtBQWxLRCw4Q0FrS0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1dlYlJlcXVlc3R9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCB7UHJlY29uZGl0aW9uc30gZnJvbSAnLi4vUHJlY29uZGl0aW9ucyc7XG5pbXBvcnQge1JlYWN0b3J9IGZyb20gJy4uL3JlYWN0b3IvUmVhY3Rvcic7XG5pbXBvcnQgT25CZWZvcmVSZWRpcmVjdERldGFpbHMgPSBFbGVjdHJvbi5PbkJlZm9yZVJlZGlyZWN0RGV0YWlscztcbmltcG9ydCBPbkJlZm9yZVJlcXVlc3REZXRhaWxzID0gRWxlY3Ryb24uT25CZWZvcmVSZXF1ZXN0RGV0YWlscztcbmltcG9ydCBPbkNvbXBsZXRlZERldGFpbHMgPSBFbGVjdHJvbi5PbkNvbXBsZXRlZERldGFpbHM7XG5pbXBvcnQgT25FcnJvck9jY3VycmVkRGV0YWlscyA9IEVsZWN0cm9uLk9uRXJyb3JPY2N1cnJlZERldGFpbHM7XG5pbXBvcnQgT25SZXNwb25zZVN0YXJ0ZWREZXRhaWxzID0gRWxlY3Ryb24uT25SZXNwb25zZVN0YXJ0ZWREZXRhaWxzO1xuaW1wb3J0IE9uU2VuZEhlYWRlcnNEZXRhaWxzID0gRWxlY3Ryb24uT25TZW5kSGVhZGVyc0RldGFpbHM7XG5cblxuZXhwb3J0IGNsYXNzIFdlYlJlcXVlc3RSZWFjdG9yIHtcblxuICAgIHB1YmxpYyByZWFkb25seSB3ZWJSZXF1ZXN0OiBXZWJSZXF1ZXN0O1xuXG4gICAgcHVibGljIHJlYWRvbmx5IHJlYWN0b3I6IFJlYWN0b3I8SU5hbWVkV2ViUmVxdWVzdEV2ZW50PjtcblxuICAgIHB1YmxpYyBzdGFydGVkID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcih3ZWJSZXF1ZXN0OiBXZWJSZXF1ZXN0KSB7XG4gICAgICAgIHRoaXMud2ViUmVxdWVzdCA9IHdlYlJlcXVlc3Q7XG4gICAgICAgIHRoaXMucmVhY3RvciA9IG5ldyBSZWFjdG9yKCk7XG4gICAgICAgIHRoaXMuc3RhcnRlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJpbmQgZWFjaCB3ZWJSZXF1ZXN0IGV2ZW50IHRvIGdvIGludG8gdGhlIHJlYWN0b3IuXG4gICAgICovXG4gICAgcHVibGljIHN0YXJ0KCkge1xuXG4gICAgICAgIHRoaXMud2ViUmVxdWVzdC5vbkJlZm9yZVJlZGlyZWN0KHRoaXMuaGFuZGxlQmVmb3JlUmVkaXJlY3QuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMud2ViUmVxdWVzdC5vbkJlZm9yZVJlcXVlc3QodGhpcy5oYW5kbGVCZWZvcmVSZXF1ZXN0LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLndlYlJlcXVlc3Qub25CZWZvcmVTZW5kSGVhZGVycyh0aGlzLmhhbmRsZUJlZm9yZVNlbmRIZWFkZXJzLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLndlYlJlcXVlc3Qub25Db21wbGV0ZWQodGhpcy5oYW5kbGVDb21wbGV0ZWQuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMud2ViUmVxdWVzdC5vbkVycm9yT2NjdXJyZWQodGhpcy5oYW5kbGVFcnJvck9jY3VycmVkLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLndlYlJlcXVlc3Qub25SZXNwb25zZVN0YXJ0ZWQodGhpcy5oYW5kbGVSZXNwb25zZVN0YXJ0ZWQuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMud2ViUmVxdWVzdC5vblNlbmRIZWFkZXJzKHRoaXMuaGFuZGxlU2VuZEhlYWRlcnMuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgLy8gVE9ETzogdGhpcyBpcyBhIGJpdCB1Z2x5IHRvIGR1cGxpY2F0ZSB0aGlzIGJ1dCBpdCBtaWdodCBiZSBwb3NzaWJsZVxuICAgICAgICAvLyB0byByZWZhY3RvciBpbiB0aGUgZnV0dXJlIHRvIG1ha2UgaXQgYSBiaXQgY2xlYW5lci5cblxuICAgICAgICBjb25zdCBldmVudE5hbWVzID0gW1xuICAgICAgICAgICAgXCJvbkJlZm9yZVJlZGlyZWN0XCIsXG4gICAgICAgICAgICBcIm9uQmVmb3JlUmVxdWVzdFwiLFxuICAgICAgICAgICAgXCJvbkJlZm9yZVNlbmRIZWFkZXJzXCIsXG4gICAgICAgICAgICBcIm9uQ29tcGxldGVkXCIsXG4gICAgICAgICAgICBcIm9uRXJyb3JPY2N1cnJlZFwiLFxuICAgICAgICAgICAgXCJvblJlc3BvbnNlU3RhcnRlZFwiLFxuICAgICAgICAgICAgXCJvblNlbmRIZWFkZXJzXCIsXG4gICAgICAgIF07XG5cbiAgICAgICAgZXZlbnROYW1lcy5mb3JFYWNoKChldmVudE5hbWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVhY3Rvci5yZWdpc3RlckV2ZW50KGV2ZW50TmFtZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuc3RhcnRlZCA9IHRydWU7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RvcCgpIHtcblxuICAgICAgICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLndlYlJlcXVlc3Qub25CZWZvcmVSZWRpcmVjdChudWxsISk7XG4gICAgICAgIHRoaXMud2ViUmVxdWVzdC5vbkJlZm9yZVJlcXVlc3QobnVsbCEpO1xuICAgICAgICB0aGlzLndlYlJlcXVlc3Qub25CZWZvcmVTZW5kSGVhZGVycyhudWxsISk7XG4gICAgICAgIHRoaXMud2ViUmVxdWVzdC5vbkNvbXBsZXRlZChudWxsISk7XG4gICAgICAgIHRoaXMud2ViUmVxdWVzdC5vbkVycm9yT2NjdXJyZWQobnVsbCEpO1xuICAgICAgICB0aGlzLndlYlJlcXVlc3Qub25SZXNwb25zZVN0YXJ0ZWQobnVsbCEpO1xuICAgICAgICB0aGlzLndlYlJlcXVlc3Qub25TZW5kSGVhZGVycyhudWxsISk7XG5cblxuICAgICAgICAvLyBUT0RPOiBjb25zaWRlciBjbGVhcmluZyB0aGUgcmVhY3RvciB0b28uXG5cbiAgICB9XG5cblxuICAgIHB1YmxpYyByZWdpc3RlcihjYWxsYmFjazogSVJlZ2lzdGVyQ2FsbGJhY2spIHtcblxuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydE5vdE51bGwoY2FsbGJhY2ssIFwiY2FsbGJhY2tcIik7XG5cbiAgICAgICAgaWYgKCEgdGhpcy5zdGFydGVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3Qgc3RhcnRlZCFcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlYWN0b3IuZXZlbnROYW1lcygpLmZvckVhY2goKGV2ZW50TmFtZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZWFjdG9yLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBjYWxsYmFjayk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVCZWZvcmVSZXF1ZXN0KGRldGFpbHM6IE9uQmVmb3JlUmVxdWVzdERldGFpbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAocmVzcG9uc2U6IEVsZWN0cm9uLlJlc3BvbnNlKSA9PiB2b2lkKTogdm9pZCB7XG5cbiAgICAgICAgdGhpcy5oYW5kbGVFdmVudCh7XG4gICAgICAgICAgICBuYW1lOiAnb25CZWZvcmVSZXF1ZXN0JyxcbiAgICAgICAgICAgIGRldGFpbHMsXG4gICAgICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUJlZm9yZVNlbmRIZWFkZXJzKGRldGFpbHM6IE9uQmVmb3JlUmVxdWVzdERldGFpbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogKHJlc3BvbnNlOiBFbGVjdHJvbi5SZXNwb25zZSkgPT4gdm9pZCk6IHZvaWQge1xuXG4gICAgICAgIHRoaXMuaGFuZGxlRXZlbnQoe1xuICAgICAgICAgICAgbmFtZTogJ29uQmVmb3JlU2VuZEhlYWRlcnMnLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIGNhbGxiYWNrLFxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlQmVmb3JlUmVkaXJlY3QoZGV0YWlsczogT25CZWZvcmVSZWRpcmVjdERldGFpbHMpOiB2b2lkIHtcblxuICAgICAgICB0aGlzLmhhbmRsZUV2ZW50KHtcbiAgICAgICAgICAgIG5hbWU6ICdvbkJlZm9yZVJlZGlyZWN0JyxcbiAgICAgICAgICAgIGRldGFpbHMsXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVDb21wbGV0ZWQoZGV0YWlsczogT25Db21wbGV0ZWREZXRhaWxzKTogdm9pZCB7XG5cbiAgICAgICAgdGhpcy5oYW5kbGVFdmVudCh7XG4gICAgICAgICAgICBuYW1lOiAnb25Db21wbGV0ZWQnLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUVycm9yT2NjdXJyZWQoZGV0YWlsczogT25FcnJvck9jY3VycmVkRGV0YWlscyk6IHZvaWQge1xuXG4gICAgICAgIHRoaXMuaGFuZGxlRXZlbnQoe1xuICAgICAgICAgICAgbmFtZTogJ29uRXJyb3JPY2N1cnJlZCcsXG4gICAgICAgICAgICBkZXRhaWxzLFxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlUmVzcG9uc2VTdGFydGVkKGRldGFpbHM6IE9uUmVzcG9uc2VTdGFydGVkRGV0YWlscyk6IHZvaWQge1xuXG4gICAgICAgIHRoaXMuaGFuZGxlRXZlbnQoe1xuICAgICAgICAgICAgbmFtZTogJ29uUmVzcG9uc2VTdGFydGVkJyxcbiAgICAgICAgICAgIGRldGFpbHMsXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgIHByaXZhdGUgaGFuZGxlU2VuZEhlYWRlcnMoZGV0YWlsczogT25TZW5kSGVhZGVyc0RldGFpbHMpOiB2b2lkIHtcblxuICAgICAgICB0aGlzLmhhbmRsZUV2ZW50KHtcbiAgICAgICAgICAgIG5hbWU6ICdvblNlbmRIZWFkZXJzJyxcbiAgICAgICAgICAgIGRldGFpbHMsXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVFdmVudChldmVudDogSU5hbWVkV2ViUmVxdWVzdEV2ZW50LCBjYWxsYmFjaz86IChyZXNwb25zZTogRWxlY3Ryb24uUmVzcG9uc2UpID0+IHZvaWQpIHtcblxuICAgICAgICBpZiAoISB0aGlzLnN0YXJ0ZWQpIHtcblxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soe2NhbmNlbDogZmFsc2V9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWFjdG9yLmRpc3BhdGNoRXZlbnQoZXZlbnQubmFtZSwgZXZlbnQpO1xuXG4gICAgfVxuXG59XG5cbmV4cG9ydCB0eXBlIElSZWdpc3RlckNhbGxiYWNrID0gKGV2ZW50OiBJTmFtZWRXZWJSZXF1ZXN0RXZlbnQpID0+IHZvaWQ7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU5hbWVkV2ViUmVxdWVzdEV2ZW50IHtcbiAgICByZWFkb25seSBuYW1lOiBzdHJpbmc7XG5cbiAgICByZWFkb25seSBkZXRhaWxzOiBJV2ViUmVxdWVzdERldGFpbHM7XG5cbiAgICByZWFkb25seSBjYWxsYmFjaz86IChyZXNwb25zZTogRWxlY3Ryb24uUmVzcG9uc2UpID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVdlYlJlcXVlc3REZXRhaWxzIHtcblxuICAgIHJlYWRvbmx5IGlkOiBudW1iZXI7XG4gICAgcmVhZG9ubHkgdXJsOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgbWV0aG9kOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgd2ViQ29udGVudHNJZD86IG51bWJlcjtcbiAgICByZWFkb25seSByZXNvdXJjZVR5cGU6IHN0cmluZztcblxufVxuIl19