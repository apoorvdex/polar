"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Callers {
    static getCaller() {
        const e = new Error();
        const stack = e.stack;
        if (stack === undefined) {
            throw new Error("No stack on error");
        }
        const frame = stack.split("\n")[3];
        const result = Callers._parse(frame);
        return result;
    }
    static _parse(frame) {
        const javascriptCaller = Callers.parseRE(frame, /([^/.\\)]+\.(js|ts|tsx|jsx)):[0-9]+:[0-9]+\)?$/g);
        const webpackCaller = Callers.parseRE(frame, /([^/.\\)]+\.(js|ts|tsx|jsx))( |\?)?/g);
        if (webpackCaller) {
            return webpackCaller;
        }
        if (javascriptCaller) {
            return javascriptCaller;
        }
        throw new Error(`Could not determine caller from frame: '${frame}'`);
    }
    static parseRE(frame, re) {
        const m = re.exec(frame);
        if (m) {
            return { filename: m[1] };
        }
        else {
            return undefined;
        }
    }
}
exports.Callers = Callers;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FsbGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNhbGxlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFhLE9BQU87SUFFVCxNQUFNLENBQUMsU0FBUztRQUVuQixNQUFNLENBQUMsR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDO1FBQ3RCLE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFFdEIsSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO1lBQ3JCLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQztTQUN4QztRQUVELE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbkMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUVyQyxPQUFPLE1BQU0sQ0FBQztJQUNsQixDQUFDO0lBTU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFhO1FBSzlCLE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsaURBQWlELENBQUMsQ0FBQztRQUduRyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxzQ0FBc0MsQ0FBQyxDQUFDO1FBRXJGLElBQUksYUFBYSxFQUFFO1lBQ2YsT0FBTyxhQUFhLENBQUM7U0FDeEI7UUFFRCxJQUFJLGdCQUFnQixFQUFFO1lBQ2xCLE9BQU8sZ0JBQWdCLENBQUM7U0FDM0I7UUFFRCxNQUFNLElBQUksS0FBSyxDQUFDLDJDQUEyQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBRXpFLENBQUM7SUFFTyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQWEsRUFBRSxFQUFVO1FBRTVDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFekIsSUFBSSxDQUFDLEVBQUU7WUFDSCxPQUFPLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1NBQzdCO2FBQU07WUFDSCxPQUFPLFNBQVMsQ0FBQztTQUNwQjtJQUVMLENBQUM7Q0FFSjtBQXhERCwwQkF3REMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgQ2FsbGVycyB7XG5cbiAgICBwdWJsaWMgc3RhdGljIGdldENhbGxlcigpIHtcblxuICAgICAgICBjb25zdCBlID0gbmV3IEVycm9yKCk7XG4gICAgICAgIGNvbnN0IHN0YWNrID0gZS5zdGFjaztcblxuICAgICAgICBpZiAoc3RhY2sgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gc3RhY2sgb24gZXJyb3JcIik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmcmFtZSA9IHN0YWNrLnNwbGl0KFwiXFxuXCIpWzNdO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IENhbGxlcnMuX3BhcnNlKGZyYW1lKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBhcnNlIGEgc3BlY2lmaWMgZnJhbWUgaW4gdGhlIHN0YWNrIHRyYWNlLlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIF9wYXJzZShmcmFtZTogc3RyaW5nKSB7XG5cbiAgICAgICAgLy8gVE9ETzogcHJvYmFibHkgYmV0dGVyIHRvIHB1dCB0aGlzIGludG8gYSBmaWx0ZXIsIGV4ZWN1dGUgYWxsIG9mIHRoZW0sXG4gICAgICAgIC8vIGFuZCB0aGVtIHJldHVybiB0aGUgcmVzdWx0cyB0b2dldGhlci5cblxuICAgICAgICBjb25zdCBqYXZhc2NyaXB0Q2FsbGVyID0gQ2FsbGVycy5wYXJzZVJFKGZyYW1lLCAvKFteLy5cXFxcKV0rXFwuKGpzfHRzfHRzeHxqc3gpKTpbMC05XSs6WzAtOV0rXFwpPyQvZyk7XG5cbiAgICAgICAgLy8gdGhpcyByZXR1cm5zIHRoZSBmaXJzdCBtYXRjaCB3aXRoIGEgc3BhY2UgYXQgdGhlIGVuZC5cbiAgICAgICAgY29uc3Qgd2VicGFja0NhbGxlciA9IENhbGxlcnMucGFyc2VSRShmcmFtZSwgLyhbXi8uXFxcXCldK1xcLihqc3x0c3x0c3h8anN4KSkoIHxcXD8pPy9nKTtcblxuICAgICAgICBpZiAod2VicGFja0NhbGxlcikge1xuICAgICAgICAgICAgcmV0dXJuIHdlYnBhY2tDYWxsZXI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoamF2YXNjcmlwdENhbGxlcikge1xuICAgICAgICAgICAgcmV0dXJuIGphdmFzY3JpcHRDYWxsZXI7XG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBkZXRlcm1pbmUgY2FsbGVyIGZyb20gZnJhbWU6ICcke2ZyYW1lfSdgKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIHBhcnNlUkUoZnJhbWU6IHN0cmluZywgcmU6IFJlZ0V4cCk6IENhbGxlciB8IHVuZGVmaW5lZCB7XG5cbiAgICAgICAgY29uc3QgbSA9IHJlLmV4ZWMoZnJhbWUpO1xuXG4gICAgICAgIGlmIChtKSB7XG4gICAgICAgICAgICByZXR1cm4geyBmaWxlbmFtZTogbVsxXSB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FsbGVyIHtcbiAgICBmaWxlbmFtZTogc3RyaW5nO1xufVxuXG4iXX0=