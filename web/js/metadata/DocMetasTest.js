"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const chai_1 = require("chai");
const DocMeta_1 = require("./DocMeta");
const DocMetas_1 = require("./DocMetas");
const MetadataSerializer_1 = require("./MetadataSerializer");
const Assertions_1 = require("../test/Assertions");
const PagemarkType_1 = require("./PagemarkType");
const TestingTime_1 = require("../test/TestingTime");
const TextHighlights_1 = require("./TextHighlights");
const Proxies_1 = require("../proxies/Proxies");
TestingTime_1.TestingTime.freeze();
describe('DocMetas', function () {
    describe('JSON', function () {
        it("Test basic JSON encoding and decoding", function () {
            const fingerprint = "0x001";
            const docMeta = DocMetas_1.DocMetas.createWithinInitialPagemarks(fingerprint, 14);
            DocMetas_1.DocMetas.addPagemarks(docMeta, { nrPages: 1, offsetPage: 4, percentage: 50 });
            const json = MetadataSerializer_1.MetadataSerializer.serialize(docMeta, "  ");
            const actual = DocMetas_1.DocMetas.deserialize(json, fingerprint);
            Assertions_1.assertJSON(docMeta, actual);
            chai_1.assert.equal(actual instanceof DocMeta_1.DocMeta, true);
        });
        it("Test with default values for serialized data", function () {
            const json = "{}";
            const docMeta = DocMetas_1.DocMetas.deserialize(json, '0x000');
            chai_1.assert.equal(docMeta instanceof DocMeta_1.DocMeta, true);
        });
    });
    describe('Deserialize', function () {
        it("Test Deserializing and then updating some pagemarks", function () {
            const fingerprint = "0x001";
            const nrPages = 2;
            let docMeta = DocMetas_1.DocMetas.createWithinInitialPagemarks(fingerprint, nrPages);
            docMeta.docInfo.uuid = "__canonicalized__";
            const json = DocMetas_1.DocMetas.serialize(docMeta, "  ");
            const expected = {
                "annotationInfo": {},
                "version": 2,
                "attachments": {},
                "docInfo": {
                    "progress": 100,
                    "pagemarkType": "SINGLE_COLUMN",
                    "properties": {},
                    "archived": false,
                    "flagged": false,
                    "tags": {},
                    "nrPages": 2,
                    "fingerprint": "0x001",
                    "added": "2012-03-02T11:38:49.321Z",
                    "uuid": "__canonicalized__",
                    "readingPerDay": {
                        "2012-03-02": 2
                    },
                },
                "pageMetas": {
                    "1": {
                        "pagemarks": {
                            "12CDjpvoCY": {
                                "id": "12CDjpvoCY",
                                "created": "2012-03-02T11:38:49.321Z",
                                "lastUpdated": "2012-03-02T11:38:49.321Z",
                                "type": "SINGLE_COLUMN",
                                "percentage": 100,
                                "column": 0,
                                "rect": {
                                    "left": 0,
                                    "top": 0,
                                    "width": 100,
                                    "height": 100
                                },
                                "batch": "1TLPYPE5XU",
                                "mode": "READ",
                                "notes": {}
                            }
                        },
                        "notes": {},
                        "comments": {},
                        "questions": {},
                        "readingProgress": {
                            "136SMQ5mZM": {
                                "created": "2012-03-02T11:38:49.321Z",
                                "id": "136SMQ5mZM",
                                "progress": 100,
                                "progressByMode": {
                                    "READ": 100,
                                }
                            }
                        },
                        "flashcards": {},
                        "textHighlights": {},
                        "areaHighlights": {},
                        "screenshots": {},
                        "thumbnails": {},
                        "pageInfo": {
                            "num": 1
                        }
                    },
                    "2": {
                        "pagemarks": {
                            "12wfHNWzGf": {
                                "id": "12wfHNWzGf",
                                "created": "2012-03-02T11:38:49.321Z",
                                "lastUpdated": "2012-03-02T11:38:49.321Z",
                                "type": "SINGLE_COLUMN",
                                "percentage": 100,
                                "column": 0,
                                "rect": {
                                    "left": 0,
                                    "top": 0,
                                    "width": 100,
                                    "height": 100
                                },
                                "batch": "12r4saWMd2",
                                "mode": "READ",
                                "notes": {}
                            }
                        },
                        "notes": {},
                        "comments": {},
                        "questions": {},
                        "readingProgress": {
                            "145xgms7VH": {
                                "created": "2012-03-02T11:38:49.321Z",
                                "id": "145xgms7VH",
                                "progress": 100,
                                "progressByMode": {
                                    "READ": 100,
                                }
                            }
                        },
                        "flashcards": {},
                        "textHighlights": {},
                        "areaHighlights": {},
                        "screenshots": {},
                        "thumbnails": {},
                        "pageInfo": {
                            "num": 2
                        }
                    }
                }
            };
            chai_1.assert.equal(typeof json, "string");
            Assertions_1.assertJSON(json, expected);
            docMeta = DocMetas_1.DocMetas.deserialize(json, fingerprint);
            docMeta = Proxies_1.Proxies.create(docMeta);
            Assertions_1.assertJSON(docMeta, expected);
            const pageMeta = docMeta.getPageMeta(1);
            pageMeta.pagemarks = {};
            chai_1.assert.deepEqual(docMeta.getPageMeta(1).pagemarks, {});
        });
    });
    describe('Upgrade', function () {
        describe("Test upgrading the metadata if it is missing fields.", function () {
            it("No DocInfo.pagemarkType", function () {
                let docMeta = createUpgradeDoc();
                chai_1.assert.notEqual(docMeta.docInfo, null);
                delete docMeta.getPageMeta(1).textHighlights;
                delete docMeta.docInfo.pagemarkType;
                docMeta = DocMetas_1.DocMetas.upgrade(docMeta);
                chai_1.assert.deepEqual(docMeta.docInfo.pagemarkType, PagemarkType_1.PagemarkType.SINGLE_COLUMN);
            });
            it("Pagemark without rect", function () {
                let docMeta = createUpgradeDoc();
                console.log(Object.keys(docMeta.getPageMeta(1).pagemarks));
                delete docMeta.getPageMeta(1).pagemarks["1hajrtFtkP"].rect;
                docMeta = DocMetas_1.DocMetas.upgrade(docMeta);
                const expected = {
                    "1hajrtFtkP": {
                        "id": "1hajrtFtkP",
                        "created": "2012-03-02T11:38:49.321Z",
                        "lastUpdated": "2012-03-02T11:38:49.321Z",
                        "type": "SINGLE_COLUMN",
                        "percentage": 100,
                        "column": 0,
                        "batch": "1jQboVWxtJ",
                        "mode": "READ",
                        "notes": {},
                        "rect": {
                            "left": 0,
                            "top": 0,
                            "width": 100,
                            "height": 100
                        }
                    }
                };
                Assertions_1.assertJSON(docMeta.getPageMeta(1).pagemarks, expected);
            });
            it("No text highlights", function () {
                let docMeta = createUpgradeDoc();
                delete docMeta.getPageMeta(1).textHighlights;
                docMeta = DocMetas_1.DocMetas.upgrade(docMeta);
                chai_1.assert.deepEqual(docMeta.getPageMeta(1).textHighlights, {});
            });
            it("No pagemarks", function () {
                let docMeta = createUpgradeDoc();
                delete docMeta.getPageMeta(1).pagemarks;
                docMeta = DocMetas_1.DocMetas.upgrade(docMeta);
                chai_1.assert.deepEqual(docMeta.getPageMeta(1).pagemarks, {});
            });
            it("No id on pagemarks", function () {
                let docMeta = createUpgradeDoc();
                console.log(JSON.stringify(docMeta.getPageMeta(1).pagemarks, null, "  "));
                console.log(Object.keys(docMeta.getPageMeta(1).pagemarks));
                (docMeta.getPageMeta(1).pagemarks["12cyUyU3s3"].id) = null;
                docMeta = DocMetas_1.DocMetas.upgrade(docMeta);
                const expected = {
                    "12cyUyU3s3": {
                        "id": "12cyUyU3s3",
                        "created": "2012-03-02T11:38:49.321Z",
                        "lastUpdated": "2012-03-02T11:38:49.321Z",
                        "type": "SINGLE_COLUMN",
                        "percentage": 100,
                        "column": 0,
                        "rect": {
                            "left": 0,
                            "top": 0,
                            "width": 100,
                            "height": 100
                        },
                        "batch": "1ZUGnh2R1J",
                        "mode": "READ",
                        "notes": {},
                    }
                };
                Assertions_1.assertJSON(docMeta.getPageMeta(1).pagemarks, expected);
            });
            it("No id on text highlights", function () {
                let docMeta = createUpgradeDoc();
                delete docMeta.getPageMeta(1).textHighlights["12pNUv1Y9S"].id;
                docMeta = DocMetas_1.DocMetas.upgrade(docMeta);
                const expected = {
                    "12pNUv1Y9S": {
                        "guid": "12pNUv1Y9S",
                        "created": "2012-03-02T11:38:49.321Z",
                        "lastUpdated": "2012-03-02T11:38:49.321Z",
                        "rects": {
                            "0": {
                                "top": 100,
                                "left": 100,
                                "right": 200,
                                "bottom": 200,
                                "width": 100,
                                "height": 100
                            }
                        },
                        "textSelections": {
                            "0": {
                                "text": "hello world",
                                "rect": null
                            }
                        },
                        "text": {
                            "TEXT": "hello world"
                        },
                        "images": {},
                        "notes": {},
                        "questions": {},
                        "flashcards": {},
                        "color": "yellow",
                        "id": "1cAbqEAHny"
                    }
                };
                Assertions_1.assertJSON(docMeta.getPageMeta(1).textHighlights, expected);
            });
        });
    });
});
function createUpgradeDoc() {
    const fingerprint = "0x001";
    const nrPages = 1;
    const docMeta = DocMetas_1.DocMetas.createWithinInitialPagemarks(fingerprint, nrPages);
    const textHighlight = TextHighlights_1.TextHighlights.createMockTextHighlight();
    docMeta.getPageMeta(1).textHighlights[textHighlight.id] = textHighlight;
    return docMeta;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9jTWV0YXNUZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRG9jTWV0YXNUZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsK0JBQTRCO0FBQzVCLHVDQUFrQztBQUNsQyx5Q0FBb0M7QUFDcEMsNkRBQXdEO0FBQ3hELG1EQUE4QztBQUM5QyxpREFBNEM7QUFDNUMscURBQWdEO0FBQ2hELHFEQUFnRDtBQUNoRCxnREFBMkM7QUFFM0MseUJBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUVyQixRQUFRLENBQUMsVUFBVSxFQUFFO0lBRWpCLFFBQVEsQ0FBQyxNQUFNLEVBQUU7UUFFYixFQUFFLENBQUMsdUNBQXVDLEVBQUU7WUFFeEMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDO1lBRTVCLE1BQU0sT0FBTyxHQUFHLG1CQUFRLENBQUMsNEJBQTRCLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3ZFLG1CQUFRLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxFQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFDLENBQUMsQ0FBQztZQUU1RSxNQUFNLElBQUksR0FBRyx1Q0FBa0IsQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRXpELE1BQU0sTUFBTSxHQUFHLG1CQUFRLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQztZQUV2RCx1QkFBVSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztZQUU1QixhQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sWUFBWSxpQkFBTyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBR2xELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFO1lBRS9DLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQztZQUVsQixNQUFNLE9BQU8sR0FBRyxtQkFBUSxDQUFDLFdB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UUFBUSxDQUFDLENBQUM7WUFFaEUsQ0FBQyxDQUFDLENBQUM7UUFFUCxDQUFDLENBQUMsQ0FBQztJQUVQLENBQUMsQ0FBQyxDQUFDO0FBRVAsQ0FBQyxDQUFDLENBQUM7QUFFSCxTQUFTLGdCQUFnQjtJQUVyQixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUM7SUFDNUIsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLE1BQU0sT0FBTyxHQUFHLG1CQUFRLENBQUMsNEJBQTRCLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRTVFLE1BQU0sYUFBYSxHQUFHLCtCQUFjLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztJQUUvRCxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLEdBQUcsYUFBYSxDQUFDO0lBRXhFLE9BQU8sT0FBTyxDQUFDO0FBRW5CLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2Fzc2VydH0gZnJvbSAnY2hhaSc7XG5pbXBvcnQge0RvY01ldGF9IGZyb20gJy4vRG9jTWV0YSc7XG5pbXBvcnQge0RvY01ldGFzfSBmcm9tICcuL0RvY01ldGFzJztcbmltcG9ydCB7TWV0YWRhdGFTZXJpYWxpemVyfSBmcm9tICcuL01ldGFkYXRhU2VyaWFsaXplcic7XG5pbXBvcnQge2Fzc2VydEpTT059IGZyb20gJy4uL3Rlc3QvQXNzZXJ0aW9ucyc7XG5pbXBvcnQge1BhZ2VtYXJrVHlwZX0gZnJvbSAnLi9QYWdlbWFya1R5cGUnO1xuaW1wb3J0IHtUZXN0aW5nVGltZX0gZnJvbSAnLi4vdGVzdC9UZXN0aW5nVGltZSc7XG5pbXBvcnQge1RleHRIaWdobGlnaHRzfSBmcm9tICcuL1RleHRIaWdobGlnaHRzJztcbmltcG9ydCB7UHJveGllc30gZnJvbSAnLi4vcHJveGllcy9Qcm94aWVzJztcblxuVGVzdGluZ1RpbWUuZnJlZXplKCk7XG5cbmRlc2NyaWJlKCdEb2NNZXRhcycsIGZ1bmN0aW9uKCkge1xuXG4gICAgZGVzY3JpYmUoJ0pTT04nLCBmdW5jdGlvbigpIHtcblxuICAgICAgICBpdChcIlRlc3QgYmFzaWMgSlNPTiBlbmNvZGluZyBhbmQgZGVjb2RpbmdcIiwgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGZpbmdlcnByaW50ID0gXCIweDAwMVwiO1xuXG4gICAgICAgICAgICBjb25zdCBkb2NNZXRhID0gRG9jTWV0YXMuY3JlYXRlV2l0aGluSW5pdGlhbFBhZ2VtYXJrcyhmaW5nZXJwcmludCwgMTQpO1xuICAgICAgICAgICAgRG9jTWV0YXMuYWRkUGFnZW1hcmtzKGRvY01ldGEsIHtuclBhZ2VzOiAxLCBvZmZzZXRQYWdlOiA0LCBwZXJjZW50YWdlOiA1MH0pO1xuXG4gICAgICAgICAgICBjb25zdCBqc29uID0gTWV0YWRhdGFTZXJpYWxpemVyLnNlcmlhbGl6ZShkb2NNZXRhLCBcIiAgXCIpO1xuXG4gICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBEb2NNZXRhcy5kZXNlcmlhbGl6ZShqc29uLCBmaW5nZXJwcmludCk7XG5cbiAgICAgICAgICAgIGFzc2VydEpTT04oZG9jTWV0YSwgYWN0dWFsKTtcblxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGFjdHVhbCBpbnN0YW5jZW9mIERvY01ldGEsIHRydWUpO1xuXG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJUZXN0IHdpdGggZGVmYXVsdCB2YWx1ZXMgZm9yIHNlcmlhbGl6ZWQgZGF0YVwiLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgY29uc3QganNvbiA9IFwie31cIjtcblxuICAgICAgICAgICAgY29uc3QgZG9jTWV0YSA9IERvY01ldGFzLmRlc2VyaWFsaXplKGpzb24sICcweDAwMCcpO1xuXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZG9jTWV0YSBpbnN0YW5jZW9mIERvY01ldGEsIHRydWUpO1xuXG4gICAgICAgIH0pO1xuXG5cblxuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0Rlc2VyaWFsaXplJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgaXQoXCJUZXN0IERlc2VyaWFsaXppbmcgYW5kIHRoZW4gdXBkYXRpbmcgc29tZSBwYWdlbWFya3NcIiwgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGZpbmdlcnByaW50ID0gXCIweDAwMVwiO1xuXG4gICAgICAgICAgICBjb25zdCBuclBhZ2VzID0gMjtcbiAgICAgICAgICAgIGxldCBkb2NNZXRhID0gRG9jTWV0YXMuY3JlYXRlV2l0aGluSW5pdGlhbFBhZ2VtYXJrcyhmaW5nZXJwcmludCwgbnJQYWdlcyk7XG5cbiAgICAgICAgICAgIGRvY01ldGEuZG9jSW5mby51dWlkID0gXCJfX2Nhbm9uaWNhbGl6ZWRfX1wiO1xuXG4gICAgICAgICAgICBjb25zdCBqc29uID0gRG9jTWV0YXMuc2VyaWFsaXplKGRvY01ldGEsIFwiICBcIik7XG5cbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkID0ge1xuICAgICAgICAgICAgICAgICAgICBcImFubm90YXRpb25JbmZvXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICBcInZlcnNpb25cIjogMixcbiAgICAgICAgICAgICAgICAgICAgXCJhdHRhY2htZW50c1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgXCJkb2NJbmZvXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicHJvZ3Jlc3NcIjogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwYWdlbWFya1R5cGVcIjogXCJTSU5HTEVfQ09MVU1OXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInByb3BlcnRpZXNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFyY2hpdmVkXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJmbGFnZ2VkXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0YWdzXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuclBhZ2VzXCI6IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImZpbmdlcnByaW50XCI6IFwiMHgwMDFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYWRkZWRcIjogXCIyMDEyLTAzLTAyVDExOjM4OjQ5LjMyMVpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXVpZFwiOiBcIl9fY2Fub25pY2FsaXplZF9fXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJlYWRpbmdQZXJEYXlcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiMjAxMi0wMy0wMlwiOiAyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBcInBhZ2VNZXRhc1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIjFcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFnZW1hcmtzXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIxMkNEanB2b0NZXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCIxMkNEanB2b0NZXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRcIjogXCIyMDEyLTAzLTAyVDExOjM4OjQ5LjMyMVpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFzdFVwZGF0ZWRcIjogXCIyMDEyLTAzLTAyVDExOjM4OjQ5LjMyMVpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcIlNJTkdMRV9DT0xVTU5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGVyY2VudGFnZVwiOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNvbHVtblwiOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyZWN0XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxlZnRcIjogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRvcFwiOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwid2lkdGhcIjogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaGVpZ2h0XCI6IDEwMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmF0Y2hcIjogXCIxVExQWVBFNVhVXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1vZGVcIjogXCJSRUFEXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5vdGVzXCI6IHt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibm90ZXNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tZW50c1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInF1ZXN0aW9uc1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJlYWRpbmdQcm9ncmVzc1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiMTM2U01RNW1aTVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRcIjogXCIyMDEyLTAzLTAyVDExOjM4OjQ5LjMyMVpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCIxMzZTTVE1bVpNXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByb2dyZXNzXCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJvZ3Jlc3NCeU1vZGVcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiUkVBRFwiOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmxhc2hjYXJkc1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRleHRIaWdobGlnaHRzXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJlYUhpZ2hsaWdodHNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzY3JlZW5zaG90c1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRodW1ibmFpbHNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwYWdlSW5mb1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtXCI6IDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCIyXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBhZ2VtYXJrc1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiMTJ3ZkhOV3pHZlwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IFwiMTJ3ZkhOV3pHZlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkXCI6IFwiMjAxMi0wMy0wMlQxMTozODo0OS4zMjFaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhc3RVcGRhdGVkXCI6IFwiMjAxMi0wMy0wMlQxMTozODo0OS4zMjFaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJTSU5HTEVfQ09MVU1OXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBlcmNlbnRhZ2VcIjogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5cIjogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicmVjdFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsZWZ0XCI6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0b3BcIjogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIndpZHRoXCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhlaWdodFwiOiAxMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhdGNoXCI6IFwiMTJyNHNhV01kMlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb2RlXCI6IFwiUkVBRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJub3Rlc1wiOiB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5vdGVzXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY29tbWVudHNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJxdWVzdGlvbnNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyZWFkaW5nUHJvZ3Jlc3NcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjE0NXhnbXM3VkhcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkXCI6IFwiMjAxMi0wMy0wMlQxMTozODo0OS4zMjFaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IFwiMTQ1eGdtczdWSFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9ncmVzc1wiOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByb2dyZXNzQnlNb2RlXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlJFQURcIjogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZsYXNoY2FyZHNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0ZXh0SGlnaGxpZ2h0c1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFyZWFIaWdobGlnaHRzXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2NyZWVuc2hvdHNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aHVtYm5haWxzXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFnZUluZm9cIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm51bVwiOiAyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwodHlwZW9mIGpzb24sIFwic3RyaW5nXCIpO1xuXG4gICAgICAgICAgICBhc3NlcnRKU09OKGpzb24sIGV4cGVjdGVkKTtcblxuICAgICAgICAgICAgZG9jTWV0YSA9IERvY01ldGFzLmRlc2VyaWFsaXplKGpzb24sIGZpbmdlcnByaW50KTtcblxuICAgICAgICAgICAgLy8gbm93IHdlIGhhdmUgdG8gdHJhY2UgaXQgbGlrZSBpdCB3b3VsZCBiZSBpbiBwcm9kdWN0aW9uLi5cbiAgICAgICAgICAgIGRvY01ldGEgPSBQcm94aWVzLmNyZWF0ZShkb2NNZXRhKTtcblxuICAgICAgICAgICAgYXNzZXJ0SlNPTihkb2NNZXRhLCBleHBlY3RlZCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHBhZ2VNZXRhID0gZG9jTWV0YS5nZXRQYWdlTWV0YSgxKTtcblxuICAgICAgICAgICAgKHBhZ2VNZXRhIGFzIGFueSkucGFnZW1hcmtzID0ge307XG5cbiAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoZG9jTWV0YS5nZXRQYWdlTWV0YSgxKS5wYWdlbWFya3MsIHt9KTtcblxuICAgICAgICB9KTtcblxuICAgIH0pO1xuXG5cbiAgICBkZXNjcmliZSgnVXBncmFkZScsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGRlc2NyaWJlKFwiVGVzdCB1cGdyYWRpbmcgdGhlIG1ldGFkYXRhIGlmIGl0IGlzIG1pc3NpbmcgZmllbGRzLlwiLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgaXQoXCJObyBEb2NJbmZvLnBhZ2VtYXJrVHlwZVwiLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIGxldCBkb2NNZXRhID0gY3JlYXRlVXBncmFkZURvYygpO1xuXG4gICAgICAgICAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGRvY01ldGEuZG9jSW5mbywgbnVsbCk7XG4gICAgICAgICAgICAgICAgZGVsZXRlIChkb2NNZXRhLmdldFBhZ2VNZXRhKDEpIGFzIGFueSkudGV4dEhpZ2hsaWdodHM7XG5cbiAgICAgICAgICAgICAgICBkZWxldGUgZG9jTWV0YS5kb2NJbmZvLnBhZ2VtYXJrVHlwZTtcblxuICAgICAgICAgICAgICAgIGRvY01ldGEgPSBEb2NNZXRhcy51cGdyYWRlKGRvY01ldGEpO1xuXG4gICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChkb2NNZXRhLmRvY0luZm8ucGFnZW1hcmtUeXBlLCBQYWdlbWFya1R5cGUuU0lOR0xFX0NPTFVNTik7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdChcIlBhZ2VtYXJrIHdpdGhvdXQgcmVjdFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsZXQgZG9jTWV0YSA9IGNyZWF0ZVVwZ3JhZGVEb2MoKTtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKE9iamVjdC5rZXlzKGRvY01ldGEuZ2V0UGFnZU1ldGEoMSkucGFnZW1hcmtzKSk7XG5cbiAgICAgICAgICAgICAgICBkZWxldGUgZG9jTWV0YS5nZXRQYWdlTWV0YSgxKS5wYWdlbWFya3NbXCIxaGFqcnRGdGtQXCJdLnJlY3QgO1xuXG4gICAgICAgICAgICAgICAgZG9jTWV0YSA9IERvY01ldGFzLnVwZ3JhZGUoZG9jTWV0YSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiMWhhanJ0RnRrUFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBcIjFoYWpydEZ0a1BcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRcIjogXCIyMDEyLTAzLTAyVDExOjM4OjQ5LjMyMVpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhc3RVcGRhdGVkXCI6IFwiMjAxMi0wMy0wMlQxMTozODo0OS4zMjFaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiU0lOR0xFX0NPTFVNTlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGVyY2VudGFnZVwiOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5cIjogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhdGNoXCI6IFwiMWpRYm9WV3h0SlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9kZVwiOiBcIlJFQURcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5vdGVzXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicmVjdFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGVmdFwiOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRvcFwiOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIndpZHRoXCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJoZWlnaHRcIjogMTAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICAgICAgYXNzZXJ0SlNPTihkb2NNZXRhLmdldFBhZ2VNZXRhKDEpLnBhZ2VtYXJrcywgZXhwZWN0ZWQpO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoXCJObyB0ZXh0IGhpZ2hsaWdodHNcIiwgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBsZXQgZG9jTWV0YSA9IGNyZWF0ZVVwZ3JhZGVEb2MoKTtcblxuICAgICAgICAgICAgICAgIGRlbGV0ZSAoZG9jTWV0YS5nZXRQYWdlTWV0YSgxKSBhcyBhbnkpLnRleHRIaWdobGlnaHRzO1xuXG4gICAgICAgICAgICAgICAgZG9jTWV0YSA9IERvY01ldGFzLnVwZ3JhZGUoZG9jTWV0YSk7XG5cbiAgICAgICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKGRvY01ldGEuZ2V0UGFnZU1ldGEoMSkudGV4dEhpZ2hsaWdodHMsIHt9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KFwiTm8gcGFnZW1hcmtzXCIsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgbGV0IGRvY01ldGEgPSBjcmVhdGVVcGdyYWRlRG9jKCk7XG5cbiAgICAgICAgICAgICAgICBkZWxldGUgKGRvY01ldGEuZ2V0UGFnZU1ldGEoMSkgYXMgYW55KS5wYWdlbWFya3M7XG5cbiAgICAgICAgICAgICAgICBkb2NNZXRhID0gRG9jTWV0YXMudXBncmFkZShkb2NNZXRhKTtcblxuICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoZG9jTWV0YS5nZXRQYWdlTWV0YSgxKS5wYWdlbWFya3MsIHt9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KFwiTm8gaWQgb24gcGFnZW1hcmtzXCIsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgbGV0IGRvY01ldGEgPSBjcmVhdGVVcGdyYWRlRG9jKCk7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShkb2NNZXRhLmdldFBhZ2VNZXRhKDEpLnBhZ2VtYXJrcywgbnVsbCwgXCIgIFwiKSk7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhPYmplY3Qua2V5cyhkb2NNZXRhLmdldFBhZ2VNZXRhKDEpLnBhZ2VtYXJrcykpO1xuXG4gICAgICAgICAgICAgICAgKDxhbnk+IChkb2NNZXRhLmdldFBhZ2VNZXRhKDEpLnBhZ2VtYXJrc1tcIjEyY3lVeVUzczNcIl0uaWQpKSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICBkb2NNZXRhID0gRG9jTWV0YXMudXBncmFkZShkb2NNZXRhKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCIxMmN5VXlVM3MzXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IFwiMTJjeVV5VTNzM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZFwiOiBcIjIwMTItMDMtMDJUMTE6Mzg6NDkuMzIxWlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFzdFVwZGF0ZWRcIjogXCIyMDEyLTAzLTAyVDExOjM4OjQ5LjMyMVpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJTSU5HTEVfQ09MVU1OXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwZXJjZW50YWdlXCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNvbHVtblwiOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicmVjdFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGVmdFwiOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRvcFwiOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIndpZHRoXCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJoZWlnaHRcIjogMTAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhdGNoXCI6IFwiMVpVR25oMlIxSlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9kZVwiOiBcIlJFQURcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5vdGVzXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICAgICAgYXNzZXJ0SlNPTihkb2NNZXRhLmdldFBhZ2VNZXRhKDEpLnBhZ2VtYXJrcywgZXhwZWN0ZWQpO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoXCJObyBpZCBvbiB0ZXh0IGhpZ2hsaWdodHNcIiwgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBsZXQgZG9jTWV0YSA9IGNyZWF0ZVVwZ3JhZGVEb2MoKTtcblxuICAgICAgICAgICAgICAgIGRlbGV0ZSBkb2NNZXRhLmdldFBhZ2VNZXRhKDEpLnRleHRIaWdobGlnaHRzW1wiMTJwTlV2MVk5U1wiXS5pZDtcblxuICAgICAgICAgICAgICAgIGRvY01ldGEgPSBEb2NNZXRhcy51cGdyYWRlKGRvY01ldGEpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWQgPSB7XG4gICAgICAgICAgICAgICAgICAgIFwiMTJwTlV2MVk5U1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImd1aWRcIjogXCIxMnBOVXYxWTlTXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRcIjogXCIyMDEyLTAzLTAyVDExOjM4OjQ5LjMyMVpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFzdFVwZGF0ZWRcIjogXCIyMDEyLTAzLTAyVDExOjM4OjQ5LjMyMVpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicmVjdHNcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiMFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidG9wXCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsZWZ0XCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyaWdodFwiOiAyMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYm90dG9tXCI6IDIwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3aWR0aFwiOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaGVpZ2h0XCI6IDEwMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRleHRTZWxlY3Rpb25zXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjBcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRleHRcIjogXCJoZWxsbyB3b3JsZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJlY3RcIjogbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRleHRcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVEVYVFwiOiBcImhlbGxvIHdvcmxkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImltYWdlc1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibm90ZXNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICBcInF1ZXN0aW9uc1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZmxhc2hjYXJkc1wiOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29sb3JcIjogXCJ5ZWxsb3dcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCIxY0FicUVBSG55XCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBhc3NlcnRKU09OKGRvY01ldGEuZ2V0UGFnZU1ldGEoMSkudGV4dEhpZ2hsaWdodHMsIGV4cGVjdGVkKTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSk7XG5cbiAgICB9KTtcblxufSk7XG5cbmZ1bmN0aW9uIGNyZWF0ZVVwZ3JhZGVEb2MoKSB7XG5cbiAgICBjb25zdCBmaW5nZXJwcmludCA9IFwiMHgwMDFcIjtcbiAgICBjb25zdCBuclBhZ2VzID0gMTtcbiAgICBjb25zdCBkb2NNZXRhID0gRG9jTWV0YXMuY3JlYXRlV2l0aGluSW5pdGlhbFBhZ2VtYXJrcyhmaW5nZXJwcmludCwgbnJQYWdlcyk7XG5cbiAgICBjb25zdCB0ZXh0SGlnaGxpZ2h0ID0gVGV4dEhpZ2hsaWdodHMuY3JlYXRlTW9ja1RleHRIaWdobGlnaHQoKTtcblxuICAgIGRvY01ldGEuZ2V0UGFnZU1ldGEoMSkudGV4dEhpZ2hsaWdodHNbdGV4dEhpZ2hsaWdodC5pZF0gPSB0ZXh0SGlnaGxpZ2h0O1xuXG4gICAgcmV0dXJuIGRvY01ldGE7XG5cbn1cbiJdfQ==