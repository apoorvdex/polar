"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const libpath = __importStar(require("path"));
const os = __importStar(require("os"));
const Optional_1 = require("./ts/Optional");
const Preconditions_1 = require("../Preconditions");
class FilePaths {
    static create(dirname, basename) {
        let result = this.join(dirname, basename);
        if (result.endsWith(libpath.sep)) {
            result = result.substring(0, result.length - 1);
        }
        return result;
    }
    static join(...paths) {
        return libpath.join(...paths);
    }
    static resolve(...pathSegments) {
        return libpath.resolve(...pathSegments);
    }
    static basename(path, ext) {
        if (libpath) {
            return libpath.basename(path, ext);
        }
        else {
            return BrowserFilePaths.basename(path, ext);
        }
    }
    static dirname(path) {
        return libpath.dirname(path);
    }
    static tmpdir() {
        return os.tmpdir();
    }
    static tmpfile(name) {
        return this.join(os.tmpdir(), name);
    }
    static createTempName(name) {
        return this.join(os.tmpdir(), name);
    }
    static toWindowsPath(path) {
        path = path.replace(/\//g, '\\');
        return 'C:' + path;
    }
    static textToWindowsPath(text) {
        return text.replace(/(\/[a-zA-Z0-9_-]+)+(\/[a-zA-Z0-9_-]+\.[a-z]{2,3})/g, (substr) => {
            return this.toWindowsPath(substr);
        });
    }
    static toFileURL(path) {
        Preconditions_1.Preconditions.assertTypeOf(path, 'string', 'path');
        path = FilePaths.resolve(path);
        if (this.SEP === '\\') {
            path = path.replace(/\\/g, '/');
            if (path[0] !== '/') {
                path = '/' + path;
            }
        }
        return encodeURI('file://' + path);
    }
    static toExtension(path) {
        if (!Preconditions_1.isPresent(path)) {
            return Optional_1.Optional.empty();
        }
        const matches = path.match(/\.([a-z0-9]{3,4})$/);
        if (matches && matches.length === 2) {
            return Optional_1.Optional.of(matches[1]);
        }
        return Optional_1.Optional.empty();
    }
}
FilePaths.SEP = libpath.sep;
exports.FilePaths = FilePaths;
class BrowserContext {
    static separator() {
        const isWindows = ["Win32", "Win64"].includes(navigator.platform);
        return isWindows ? "\\" : "/";
    }
}
exports.BrowserContext = BrowserContext;
class BrowserFilePaths {
    static basename(path, ext) {
        const lastIndexOf = path.lastIndexOf(this.SEP);
        const result = lastIndexOf >= 0 ? path.substring(lastIndexOf + 1) : path;
        if (ext) {
            if (result.endsWith(ext)) {
                return result.substring(0, result.length - ext.length);
            }
            else {
                return result;
            }
        }
        else {
            return result;
        }
    }
}
BrowserFilePaths.SEP = typeof navigator !== 'undefined' && navigator.platform ? BrowserContext.separator() : '/';
exports.BrowserFilePaths = BrowserFilePaths;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmlsZVBhdGhzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRmlsZVBhdGhzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLDhDQUFnQztBQUNoQyx1Q0FBeUI7QUFDekIsNENBQXVDO0FBQ3ZDLG9EQUEwRDtBQVUxRCxNQUFhLFNBQVM7SUFrQlgsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFlLEVBQUUsUUFBZ0I7UUFDbEQsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFFMUMsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUM5QixNQUFNLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztTQUNuRDtRQUVELE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFVTSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBZTtRQUNqQyxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBbUJNLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxZQUFzQjtRQUMzQyxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxZQUFZLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBWU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFZLEVBQUUsR0FBWTtRQUU3QyxJQUFJLE9BQU8sRUFBRTtZQUNULE9BQU8sT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDdEM7YUFBTTtZQUNILE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztTQUMvQztJQUVMLENBQUM7SUFFTSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQVk7UUFDOUIsT0FBTyxPQUFP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QyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFFekUsSUFBSSxHQUFHLEVBQUU7WUFFTCxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQ3RCLE9BQU8sTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDMUQ7aUJBQU07Z0JBQ0gsT0FBTyxNQUFNLENBQUM7YUFDakI7U0FFSjthQUFNO1lBQ0gsT0FBTyxNQUFNLENBQUM7U0FDakI7SUFFTCxDQUFDOztBQTNCYSxvQkFBRyxHQUNiLE9BQU8sU0FBUyxLQUFLLFdBQVcsSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztBQUhsRyw0Q0ErQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBsaWJwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgb3MgZnJvbSAnb3MnO1xuaW1wb3J0IHtPcHRpb25hbH0gZnJvbSAnLi90cy9PcHRpb25hbCc7XG5pbXBvcnQge2lzUHJlc2VudCwgUHJlY29uZGl0aW9uc30gZnJvbSAnLi4vUHJlY29uZGl0aW9ucyc7XG5pbXBvcnQgdXJsIGZyb20gJ3VybCc7XG5cbi8qKlxuICogV29yayB3aXRoIGZpbGUgcGF0aHMgY3Jvc3MgcGxhdGZvcm0gYW5kIHdvcmsgd2l0aCB0aGUgZmlsZSBzZXBhcmF0b3IgdXNpbmdcbiAqIHRoZSAvIGNoYXIgb24gVW5peCBhbmQgdGhlIFxcIGNoYXIgb24gV2luZG93cy5cbiAqXG4gKiBETyBOT1QgY2FsbCB0aGlzIGZvciBVUkkgcGF0aHMgdGhhdCBhcmUgYWx3YXlzIC8gbm8gbWF0dGVyIHdoYXQgT1MgeW91IGFyZVxuICogb24uXG4gKi9cbmV4cG9ydCBjbGFzcyBGaWxlUGF0aHMge1xuXG4gICAgLyoqXG4gICAgICogVGhlIE9TIHNwZWNpZmljIGZpbGUgc2VwYXJhdG9yLlxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgU0VQID0gbGlicGF0aC5zZXA7XG5cbiAgICAvLyBGSVhNRTogVEhJUyBpcyB0aGUgYnVnLi4gV2luZG93cyBqdXN0IG5lZWRzIHRvIGRpZSEgIFdlJ3JlIG5vdCBwcm9wZXJseVxuICAgIC8vIGJ1aWxkaW5nIFVSSSBwYXRocyBkdWUgdG8gdGhpcyBpc3N1ZSBub3cuLi5cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHBhdGggZnJvbSB0aGUgZ2l2ZW4gcGFydHMgcmVnYXJkbGVzcyBvZiB0aGVpciBzdHJ1Y3R1cmUuXG4gICAgICpcbiAgICAgKiBEb24ndCBhbGxvdyBkb3VibGUgLy8gb3IgdHJhaWxpbmcgLy4gIFRoZSBvdXRwdXQgaXMgYWx3YXlzIHNhbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGlybmFtZVxuICAgICAqIEBwYXJhbSBiYXNlbmFtZVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlKGRpcm5hbWU6IHN0cmluZywgYmFzZW5hbWU6IHN0cmluZykge1xuICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5qb2luKGRpcm5hbWUsIGJhc2VuYW1lKTtcblxuICAgICAgICBpZiAocmVzdWx0LmVuZHNXaXRoKGxpYnBhdGguc2VwKSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnN1YnN0cmluZygwLCByZXN1bHQubGVuZ3RoIC0gMSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEpvaW4gYWxsIGFyZ3VtZW50cyB0b2dldGhlciBhbmQgbm9ybWFsaXplIHRoZSByZXN1bHRpbmcgcGF0aC5cbiAgICAgKlxuICAgICAqIEFyZ3VtZW50cyBtdXN0IGJlIHN0cmluZ3MuIEluIHYwLjgsIG5vbi1zdHJpbmcgYXJndW1lbnRzIHdlcmUgc2lsZW50bHlcbiAgICAgKiBpZ25vcmVkLiBJbiB2MC4xMCBhbmQgdXAsIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aHMgcGF0aHMgdG8gam9pbi5cbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGpvaW4oLi4ucGF0aHM6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGxpYnBhdGguam9pbiguLi5wYXRocyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIHJpZ2h0LW1vc3QgcGFyYW1ldGVyIGlzIGNvbnNpZGVyZWQge3RvfS4gIE90aGVyIHBhcmFtZXRlcnMgYXJlXG4gICAgICogY29uc2lkZXJlZCBhbiBhcnJheSBvZiB7ZnJvbX0uXG4gICAgICpcbiAgICAgKiBTdGFydGluZyBmcm9tIGxlZnRtb3N0IHtmcm9tfSBwYXJhbWV0ZXIsIHJlc29sdmVzIHt0b30gdG8gYW4gYWJzb2x1dGVcbiAgICAgKiBwYXRoLlxuICAgICAqXG4gICAgICogSWYge3RvfSBpc24ndCBhbHJlYWR5IGFic29sdXRlLCB7ZnJvbX0gYXJndW1lbnRzIGFyZSBwcmVwZW5kZWQgaW4gcmlnaHRcbiAgICAgKiB0byBsZWZ0IG9yZGVyLCB1bnRpbCBhbiBhYnNvbHV0ZSBwYXRoIGlzIGZvdW5kLiBJZiBhZnRlciB1c2luZyBhbGxcbiAgICAgKiB7ZnJvbX0gcGF0aHMgc3RpbGwgbm8gYWJzb2x1dGUgcGF0aCBpcyBmb3VuZCwgdGhlIGN1cnJlbnQgd29ya2luZ1xuICAgICAqIGRpcmVjdG9yeSBpcyB1c2VkIGFzIHdlbGwuIFRoZSByZXN1bHRpbmcgcGF0aCBpcyBub3JtYWxpemVkLCBhbmRcbiAgICAgKiB0cmFpbGluZyBzbGFzaGVzIGFyZSByZW1vdmVkIHVubGVzcyB0aGUgcGF0aCBnZXRzIHJlc29sdmVkIHRvIHRoZSByb290XG4gICAgICogZGlyZWN0b3J5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHBhdGhTZWdtZW50cyBzdHJpbmcgcGF0aHMgdG8gam9pbi4gIE5vbi1zdHJpbmcgYXJndW1lbnRzIGFyZVxuICAgICAqICAgICBpZ25vcmVkLlxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVzb2x2ZSguLi5wYXRoU2VnbWVudHM6IHN0cmluZ1tdKSB7XG4gICAgICAgIHJldHVybiBsaWJwYXRoLnJlc29sdmUoLi4ucGF0aFNlZ21lbnRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIGxhc3QgcG9ydGlvbiBvZiBhIHBhdGguIFNpbWlsYXIgdG8gdGhlIFVuaXggYmFzZW5hbWUgY29tbWFuZC5cbiAgICAgKiBPZnRlbiB1c2VkIHRvIGV4dHJhY3QgdGhlIGZpbGUgbmFtZSBmcm9tIGEgZnVsbHkgcXVhbGlmaWVkIHBhdGguXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgdGhpcyBiZWhhdmVzIGRpZmZlcmVudGx5IG9uIFdpbmRvd3MgdnMgTGludXguICBUaGUgcGF0aFxuICAgICAqIHNlcGFyYXRvciBpcyBjaGFuZ2VkIGFuZCBkaWZmZXJlbnQgdmFsdWVzIGFyZSByZXR1cm5lZCBmb3IgdGhlIHBsYXRmb3JtLlxuICAgICAqXG4gICAgICogQHBhcmFtIHBhdGggdGhlIHBhdGggdG8gZXZhbHVhdGUuXG4gICAgICogQHBhcmFtIGV4dCBvcHRpb25hbGx5LCBhbiBleHRlbnNpb24gdG8gcmVtb3ZlIGZyb20gdGhlIHJlc3VsdC5cbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGJhc2VuYW1lKHBhdGg6IHN0cmluZywgZXh0Pzogc3RyaW5nKSB7XG5cbiAgICAgICAgaWYgKGxpYnBhdGgpIHtcbiAgICAgICAgICAgIHJldHVybiBsaWJwYXRoLmJhc2VuYW1lKHBhdGgsIGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gQnJvd3NlckZpbGVQYXRocy5iYXNlbmFtZShwYXRoLCBleHQpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGRpcm5hbWUocGF0aDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBsaWJwYXRoLmRpcm5hbWUocGF0aCk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyB0bXBkaXIoKSB7XG4gICAgICAgIHJldHVybiBvcy50bXBkaXIoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZGVwcmVjYXRlZCB1c2UgY3JlYXRlVGVtcE5hbWVcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHRtcGZpbGUobmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmpvaW4ob3MudG1wZGlyKCksIG5hbWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5hbWVkIHBhdGggZW50cnkgaW4gL3RtcFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlVGVtcE5hbWUobmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmpvaW4ob3MudG1wZGlyKCksIG5hbWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHdpbmRvd3MgcGF0aCBmcm9tIHVuaXggcGF0aC4gIE1vc3RseSB1c2VkIGZvciB0ZXN0aW5nLlxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgdG9XaW5kb3dzUGF0aChwYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvXFwvL2csICdcXFxcJyApO1xuICAgICAgICByZXR1cm4gJ0M6JyArIHBhdGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCB1bml4IHBhdGggc3RyaW5ncyBpbiB0ZXh0IGFuZCByZXBsYWNlIHRoZW0gd2l0aCB3aW5kb3dzLWxpa2UgcGF0aHMuXG4gICAgICpcbiAgICAgKiBVc2VkIGZvciB0ZXN0aW5nLlxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgdGV4dFRvV2luZG93c1BhdGgodGV4dDogc3RyaW5nKSB7XG5cbiAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvKFxcL1thLXpBLVowLTlfLV0rKSsoXFwvW2EtekEtWjAtOV8tXStcXC5bYS16XXsyLDN9KS9nLCAoc3Vic3RyOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvV2luZG93c1BhdGgoc3Vic3RyKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHRvRmlsZVVSTChwYXRoOiBzdHJpbmcpIHtcblxuICAgICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yMDYxOTQ4OC9ob3ctdG8tY29udmVydC1sb2NhbC1maWxlLXBhdGgtdG8tYS1maWxlLXVybC1zYWZlbHktaW4tbm9kZS1qc1xuXG4gICAgICAgIC8vIFRPRE86IFRoZSBuZXcgcGF0aFRvRmlsZVVSTCBmdW5jdGlvbiBhZGRlZCBpbiBOb2RlSlMgMTAuMTIgYW5kXG4gICAgICAgIC8vIEVsZWN0cm9uIDMuMC44OSBpcyBvbiAxMC4yIGF0IHRoZSB0aW1lIHNvIHdlIGNhbid0IHVzZSB0aGlzIGZ1bmN0aW9uXG4gICAgICAgIC8vIGV2ZW4gdGhvdWdoIGl0J3MgYmV0dGVyLlxuXG4gICAgICAgIFByZWNvbmRpdGlvbnMuYXNzZXJ0VHlwZU9mKHBhdGgsICdzdHJpbmcnLCAncGF0aCcpO1xuXG4gICAgICAgIHBhdGggPSBGaWxlUGF0aHMucmVzb2x2ZShwYXRoKTtcblxuICAgICAgICBpZiAodGhpcy5TRVAgPT09ICdcXFxcJykge1xuXG4gICAgICAgICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG5cbiAgICAgICAgICAgIC8vIFdpbmRvd3MgZHJpdmUgbGV0dGVyIG11c3QgYmUgcHJlZml4ZWQgd2l0aCBhIHNsYXNoXG4gICAgICAgICAgICBpZiAocGF0aFswXSAhPT0gJy8nKSB7XG4gICAgICAgICAgICAgICAgcGF0aCA9ICcvJyArIHBhdGg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbmNvZGVVUkkoJ2ZpbGU6Ly8nICsgcGF0aCk7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJZiB0aGUgZmlsZSBlbmRzIHdpdGggLnR4dCwgLnBkZiwgLmh0bWwgdGhlbiByZXR1cm4gdGhlIGV4dGVuc2lvbi5cbiAgICAgKiBAcGFyYW0gcGF0aFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgdG9FeHRlbnNpb24ocGF0aDogc3RyaW5nKTogT3B0aW9uYWw8c3RyaW5nPiB7XG5cbiAgICAgICAgaWYgKCEgaXNQcmVzZW50KHBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuZW1wdHkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBwYXRoLm1hdGNoKC9cXC4oW2EtejAtOV17Myw0fSkkLyk7XG5cbiAgICAgICAgaWYgKG1hdGNoZXMgJiYgbWF0Y2hlcy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5vZihtYXRjaGVzWzFdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBPcHRpb25hbC5lbXB0eSgpO1xuXG4gICAgfVxuXG59XG5cbmV4cG9ydCBjbGFzcyBCcm93c2VyQ29udGV4dCB7XG5cbiAgICBwdWJsaWMgc3RhdGljIHNlcGFyYXRvcigpIHtcbiAgICAgICAgY29uc3QgaXNXaW5kb3dzID0gW1wiV2luMzJcIiwgXCJXaW42NFwiXS5pbmNsdWRlcyhuYXZpZ2F0b3IucGxhdGZvcm0pO1xuICAgICAgICByZXR1cm4gaXNXaW5kb3dzID8gXCJcXFxcXCIgOiBcIi9cIjtcbiAgICB9XG5cbn1cblxuLyoqXG4gKiBCcm93c2VyIGltcGxlbWVudGF0aW9ucyBvZiBzb21lIGZ1bmN0aW9ucyBpbiBub2RlLlxuICovXG5leHBvcnQgY2xhc3MgQnJvd3NlckZpbGVQYXRocyB7XG5cbiAgICBwdWJsaWMgc3RhdGljIFNFUCA9XG4gICAgICAgIHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIG5hdmlnYXRvci5wbGF0Zm9ybSA/IEJyb3dzZXJDb250ZXh0LnNlcGFyYXRvcigpIDogJy8nO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aFxuICAgICAqIEBwYXJhbSBleHRcbiAgICAgKiBAcGFyYW0gc2VwIFVzZSBhIHNwZWNpZmljIHNlcGFyYXRvciB3aGVuIGdpdmVuIChub3QgZGV0ZXJtaW5lZCBieSBwbGF0Zm9ybSlcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGJhc2VuYW1lKHBhdGg6IHN0cmluZywgZXh0Pzogc3RyaW5nKSB7XG5cbiAgICAgICAgY29uc3QgbGFzdEluZGV4T2YgPSBwYXRoLmxhc3RJbmRleE9mKHRoaXMuU0VQKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBsYXN0SW5kZXhPZiA+PSAwID8gcGF0aC5zdWJzdHJpbmcobGFzdEluZGV4T2YgKyAxKSA6IHBhdGg7XG5cbiAgICAgICAgaWYgKGV4dCkge1xuXG4gICAgICAgICAgICBpZiAocmVzdWx0LmVuZHNXaXRoKGV4dCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LnN1YnN0cmluZygwLCByZXN1bHQubGVuZ3RoIC0gZXh0Lmxlbmd0aCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgIH1cblxufVxuIl19