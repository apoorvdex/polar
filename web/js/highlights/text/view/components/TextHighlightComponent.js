"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Preconditions_1 = require("../../../../Preconditions");
const Dictionaries_1 = require("../../../../util/Dictionaries");
const Component_1 = require("../../../../components/Component");
const DocFormatFactory_1 = require("../../../../docformat/DocFormatFactory");
const Rects_1 = require("../../../../Rects");
const Logger_1 = require("../../../../logger/Logger");
const log = Logger_1.Logger.create();
class TextHighlightComponent extends Component_1.Component {
    constructor() {
        super();
        this.textHighlight = undefined;
        this.docFormat = DocFormatFactory_1.DocFormatFactory.getInstance();
    }
    init(annotationEvent) {
        this.docMeta = annotationEvent.docMeta;
        this.textHighlight = annotationEvent.value;
        this.pageMeta = annotationEvent.pageMeta;
        this.pageNum = this.pageMeta.pageInfo.num;
        this.pageElement = this.docFormat.getPageElementFromPageNum(this.pageNum);
    }
    render() {
        this.destroy();
        log.debug("render()");
        Dictionaries_1.Dictionaries.forDict(this.textHighlight.rects, (id, highlightRect) => {
            const pageElement = Preconditions_1.Preconditions.assertPresent(this.pageElement);
            const pageMeta = Preconditions_1.Preconditions.assertPresent(this.pageMeta);
            const docMeta = Preconditions_1.Preconditions.assertPresent(this.docMeta);
            const textHighlight = Preconditions_1.Preconditions.assertPresent(this.textHighlight);
            log.debug("Rendering annotation at: " + JSON.stringify(highlightRect, null, "  "));
            const highlightElement = document.createElement("div");
            highlightElement.setAttribute("data-type", "text-highlight");
            highlightElement.setAttribute("data-doc-fingerprint", docMeta.docInfo.fingerprint);
            highlightElement.setAttribute("data-text-highlight-id", textHighlight.id);
            highlightElement.setAttribute("data-page-num", `${pageMeta.pageInfo.num}`);
            highlightElement.setAttribute("data-annotation-type", "text-highlight");
            highlightElement.setAttribute("data-annotation-id", textHighlight.id);
            highlightElement.setAttribute("data-annotation-page-num", `${pageMeta.pageInfo.num}`);
            highlightElement.setAttribute("data-annotation-doc-fingerprint", docMeta.docInfo.fingerprint);
            const color = textHighlight.color || 'yellow';
            highlightElement.setAttribute("data-annotation-color", color);
            highlightElement.className = `text-highlight annotation text-highlight-${textHighlight.id}`;
            highlightElement.style.position = "absolute";
            if (this.docFormat.name === "pdf") {
                const currentScale = this.docFormat.currentScale();
                highlightRect = Rects_1.Rects.scale(highlightRect, currentScale);
            }
            highlightElement.style.left = `${highlightRect.left}px`;
            highlightElement.style.top = `${highlightRect.top}px`;
            highlightElement.style.width = `${highlightRect.width}px`;
            highlightElement.style.height = `${highlightRect.height}px`;
            pageElement.insertBefore(highlightElement, pageElement.firstChild);
        });
    }
    destroy() {
        const selector = `.text-highlight-${this.textHighlight.id}`;
        const highlightElements = document.querySelectorAll(selector);
        log.debug(`Found N elements for selector ${selector}: ` + highlightElements.length);
        highlightElements.forEach(highlightElement => {
            highlightElement.parentElement.removeChild(highlightElement);
        });
    }
}
exports.TextHighlightComponent = TextHighlightComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGV4dEhpZ2hsaWdodENvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlRleHRIaWdobGlnaHRDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFLQSw2REFBd0Q7QUFDeEQsZ0VBQTJEO0FBRTNELGdFQUEyRDtBQUMzRCw2RUFBd0U7QUFDeEUsNkNBQXdDO0FBQ3hDLHNEQUFpRDtBQUdqRCxNQUFNLEdBQUcsR0FBRyxlQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7QUFFNUIsTUFBYSxzQkFBdUIsU0FBUSxxQkFBUztJQThCakQ7UUFDSSxLQUFLLEVBQUUsQ0FBQztRQW5CSixrQkFBYSxHQUFtQixTQUFTLENBQUM7UUFxQjlDLElBQUksQ0FBQyxTQUFTLEdBQUcsbUNBQWdCLENBQUMsV0FBVyxFQUFFLENBQUM7SUFFcEQsQ0FBQztJQU1NLElBQUksQ0FBQyxlQUFnQztRQUl4QyxJQUFJLENBQUMsT0FBTyxHQUFHLGVBQWUsQ0FBQyxPQUFPLENBQUM7UUFDdkMsSUFBSSxDQUFDLGFBQWEsR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDO1FBQzNDLElBQUksQ0FBQyxRQUFRLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQztRQUV6QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQztRQUMxQyxJQUFJLENBQUMsV0FBVyxHQUFpQixJQUFJLENBQUMsU0FBUyxDQUFDLHlCQUF5QixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUU1RixDQUFDO0lBS00sTUFBTTtRQUVULElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUVmLEdBQUcsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFdEIsMkJBQVksQ0FBQyxPQUFPLENBQU8sSUFBSSxDQUFDLGFBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsYUFBYSxFQUFFLEVBQUU7WUFFeEUsTUFBTSxX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UUFDN0QsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFOUQsR0FBRyxDQUFDLEtBQUssQ0FBQyxpQ0FBaUMsUUFBUSxJQUFJLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFcEYsaUJBQWlCLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEVBQUU7WUFDekMsZ0JBQWdCLENBQUMsYUFBYyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2xFLENBQUMsQ0FBQyxDQUFDO0lBRVAsQ0FBQztDQUVKO0FBdElELHdEQXNJQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RG9jTWV0YX0gZnJvbSAnLi4vLi4vLi4vLi4vbWV0YWRhdGEvRG9jTWV0YSc7XG5pbXBvcnQge0RvY0Zvcm1hdH0gZnJvbSAnLi4vLi4vLi4vLi4vZG9jZm9ybWF0L0RvY0Zvcm1hdCc7XG5pbXBvcnQge1RleHRIaWdobGlnaHR9IGZyb20gJy4uLy4uLy4uLy4uL21ldGFkYXRhL1RleHRIaWdobGlnaHQnO1xuaW1wb3J0IHtQYWdlTWV0YX0gZnJvbSAnLi4vLi4vLi4vLi4vbWV0YWRhdGEvUGFnZU1ldGEnO1xuaW1wb3J0IHtBbm5vdGF0aW9uRXZlbnR9IGZyb20gJy4uLy4uLy4uLy4uL2Fubm90YXRpb25zL2NvbXBvbmVudHMvQW5ub3RhdGlvbkV2ZW50JztcbmltcG9ydCB7UHJlY29uZGl0aW9uc30gZnJvbSAnLi4vLi4vLi4vLi4vUHJlY29uZGl0aW9ucyc7XG5pbXBvcnQge0RpY3Rpb25hcmllc30gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbC9EaWN0aW9uYXJpZXMnO1xuaW1wb3J0IHtSZWN0fSBmcm9tICcuLi8uLi8uLi8uLi9SZWN0JztcbmltcG9ydCB7Q29tcG9uZW50fSBmcm9tICcuLi8uLi8uLi8uLi9jb21wb25lbnRzL0NvbXBvbmVudCc7XG5pbXBvcnQge0RvY0Zvcm1hdEZhY3Rvcnl9IGZyb20gJy4uLy4uLy4uLy4uL2RvY2Zvcm1hdC9Eb2NGb3JtYXRGYWN0b3J5JztcbmltcG9ydCB7UmVjdHN9IGZyb20gJy4uLy4uLy4uLy4uL1JlY3RzJztcbmltcG9ydCB7TG9nZ2VyfSBmcm9tICcuLi8uLi8uLi8uLi9sb2dnZXIvTG9nZ2VyJztcbmltcG9ydCB7SGlnaGxpZ2h0Q29sb3J9IGZyb20gJy4uLy4uLy4uLy4uL21ldGFkYXRhL0Jhc2VIaWdobGlnaHQnO1xuXG5jb25zdCBsb2cgPSBMb2dnZXIuY3JlYXRlKCk7XG5cbmV4cG9ydCBjbGFzcyBUZXh0SGlnaGxpZ2h0Q29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcblxuICAgIHByaXZhdGUgZG9jRm9ybWF0OiBEb2NGb3JtYXQ7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIHByaXZhdGUgZG9jTWV0YT86IERvY01ldGE7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIHByaXZhdGUgdGV4dEhpZ2hsaWdodD86IFRleHRIaWdobGlnaHQgPSB1bmRlZmluZWQ7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIHByaXZhdGUgcGFnZU1ldGE/OiBQYWdlTWV0YTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBwYWdlIHdlJ3JlIHdvcmtpbmcgd2l0aC5cbiAgICAgKi9cbiAgICBwcml2YXRlIHBhZ2VOdW0/OiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgLnBhZ2Ugd2UncmUgd29ya2luZyB3aXRoLlxuICAgICAqXG4gICAgICovXG4gICAgcHJpdmF0ZSBwYWdlRWxlbWVudD86IEhUTUxFbGVtZW50O1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5kb2NGb3JtYXQgPSBEb2NGb3JtYXRGYWN0b3J5LmdldEluc3RhbmNlKCk7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAT3ZlcnJpZGVcbiAgICAgKiBAcGFyYW0gYW5ub3RhdGlvbkV2ZW50XG4gICAgICovXG4gICAgcHVibGljIGluaXQoYW5ub3RhdGlvbkV2ZW50OiBBbm5vdGF0aW9uRXZlbnQpIHtcblxuICAgICAgICAvLyBUT0RPOiB3ZSBzaG91bGQgYSBzcGVjaWZpYyBldmVudCBjbGFzcyBmb3IgdGhpcyBkYXRhIHdoaWNoIGlzIGNhcHR1cmVkXG4gICAgICAgIC8vIHdpdGhpbiBhIGhpZ2hlciBsZXZlbCBhbm5vdGF0aW9uRXZlbnQuXG4gICAgICAgIHRoaXMuZG9jTWV0YSA9IGFubm90YXRpb25FdmVudC5kb2NNZXRhO1xuICAgICAgICB0aGlzLnRleHRIaWdobGlnaHQgPSBhbm5vdGF0aW9uRXZlbnQudmFsdWU7XG4gICAgICAgIHRoaXMucGFnZU1ldGEgPSBhbm5vdGF0aW9uRXZlbnQucGFnZU1ldGE7XG5cbiAgICAgICAgdGhpcy5wYWdlTnVtID0gdGhpcy5wYWdlTWV0YS5wYWdlSW5mby5udW07XG4gICAgICAgIHRoaXMucGFnZUVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuZG9jRm9ybWF0LmdldFBhZ2VFbGVtZW50RnJvbVBhZ2VOdW0odGhpcy5wYWdlTnVtKTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBPdmVycmlkZVxuICAgICAqL1xuICAgIHB1YmxpYyByZW5kZXIoKSB7XG5cbiAgICAgICAgdGhpcy5kZXN0cm95KCk7XG5cbiAgICAgICAgbG9nLmRlYnVnKFwicmVuZGVyKClcIik7XG5cbiAgICAgICAgRGljdGlvbmFyaWVzLmZvckRpY3Q8UmVjdD4odGhpcy50ZXh0SGlnaGxpZ2h0IS5yZWN0cywgKGlkLCBoaWdobGlnaHRSZWN0KSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IHBhZ2VFbGVtZW50ID0gUHJlY29uZGl0aW9ucy5hc3NlcnRQcmVzZW50KHRoaXMucGFnZUVsZW1lbnQpO1xuICAgICAgICAgICAgY29uc3QgcGFnZU1ldGEgPSBQcmVjb25kaXRpb25zLmFzc2VydFByZXNlbnQodGhpcy5wYWdlTWV0YSk7XG4gICAgICAgICAgICBjb25zdCBkb2NNZXRhID0gUHJlY29uZGl0aW9ucy5hc3NlcnRQcmVzZW50KHRoaXMuZG9jTWV0YSk7XG4gICAgICAgICAgICBjb25zdCB0ZXh0SGlnaGxpZ2h0ID0gUHJlY29uZGl0aW9ucy5hc3NlcnRQcmVzZW50KHRoaXMudGV4dEhpZ2hsaWdodCk7XG5cbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhcIlJlbmRlcmluZyBhbm5vdGF0aW9uIGF0OiBcIiArIEpTT04uc3RyaW5naWZ5KGhpZ2hsaWdodFJlY3QsIG51bGwsIFwiICBcIikpO1xuXG4gICAgICAgICAgICBjb25zdCBoaWdobGlnaHRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXR5cGVcIiwgXCJ0ZXh0LWhpZ2hsaWdodFwiKTtcbiAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1kb2MtZmluZ2VycHJpbnRcIiwgZG9jTWV0YS5kb2NJbmZvLmZpbmdlcnByaW50KTtcbiAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS10ZXh0LWhpZ2hsaWdodC1pZFwiLCB0ZXh0SGlnaGxpZ2h0LmlkKTtcbiAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1wYWdlLW51bVwiLCBgJHtwYWdlTWV0YS5wYWdlSW5mby5udW19YCk7XG5cbiAgICAgICAgICAgIC8vIGFubm90YXRpb24gZGVzY3JpcHRvciBtZXRhZGF0YS5cbiAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1hbm5vdGF0aW9uLXR5cGVcIiwgXCJ0ZXh0LWhpZ2hsaWdodFwiKTtcbiAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1hbm5vdGF0aW9uLWlkXCIsIHRleHRIaWdobGlnaHQuaWQpO1xuICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWFubm90YXRpb24tcGFnZS1udW1cIiwgYCR7cGFnZU1ldGEucGFnZUluZm8ubnVtfWApO1xuICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWFubm90YXRpb24tZG9jLWZpbmdlcnByaW50XCIsIGRvY01ldGEuZG9jSW5mby5maW5nZXJwcmludCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbG9yOiBIaWdobGlnaHRDb2xvciA9IHRleHRIaWdobGlnaHQuY29sb3IgfHwgJ3llbGxvdyc7XG5cbiAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1hbm5vdGF0aW9uLWNvbG9yXCIsIGNvbG9yKTtcblxuICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudC5jbGFzc05hbWUgPSBgdGV4dC1oaWdobGlnaHQgYW5ub3RhdGlvbiB0ZXh0LWhpZ2hsaWdodC0ke3RleHRIaWdobGlnaHQuaWR9YDtcblxuICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgICAgICAgIC8vIGhpZ2hsaWdodEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gYHllbGxvd2A7XG4gICAgICAgICAgICAvLyBoaWdobGlnaHRFbGVtZW50LnN0eWxlLm9wYWNpdHkgPSBgMC41YDtcblxuICAgICAgICAgICAgaWYgKHRoaXMuZG9jRm9ybWF0Lm5hbWUgPT09IFwicGRmXCIpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIG9ubHkgbmVlZGVkIGZvciBQREYgYW5kIHdlIG1pZ2h0IGJlIGFibGUgdG8gdXNlIGEgdHJhbnNmb3JtXG4gICAgICAgICAgICAgICAgLy8gaW4gdGhlIGZ1dHVyZSB3aGljaCB3b3VsZCBiZSBlYXNpZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFNjYWxlID0gdGhpcy5kb2NGb3JtYXQuY3VycmVudFNjYWxlKCk7XG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0UmVjdCA9IFJlY3RzLnNjYWxlKGhpZ2hsaWdodFJlY3QsIGN1cnJlbnRTY2FsZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQuc3R5bGUubGVmdCA9IGAke2hpZ2hsaWdodFJlY3QubGVmdH1weGA7XG4gICAgICAgICAgICBoaWdobGlnaHRFbGVtZW50LnN0eWxlLnRvcCA9IGAke2hpZ2hsaWdodFJlY3QudG9wfXB4YDtcblxuICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudC5zdHlsZS53aWR0aCA9IGAke2hpZ2hsaWdodFJlY3Qud2lkdGh9cHhgO1xuICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudC5zdHlsZS5oZWlnaHQgPSBgJHtoaWdobGlnaHRSZWN0LmhlaWdodH1weGA7XG5cbiAgICAgICAgICAgIC8vIFRPRE86IHRoZSBwcm9ibGVtIHdpdGggdGhpcyBzdHJhdGVneSBpcyB0aGF0IGl0IGluc2VydHMgZWxlbWVudHMgaW4gdGhlXG4gICAgICAgICAgICAvLyBSRVZFUlNFIG9yZGVyIHRoZXkgYXJlIHByZXNlbnRlZCB2aXN1YWxseS4gIFRoaXMgaXNuJ3QgYSBwcm9ibGVtIGJ1dFxuICAgICAgICAgICAgLy8gaXQgbWlnaHQgYmVjb21lIGNvbmZ1c2luZyB0byBkZWJ1ZyB0aGlzIGlzc3VlLiAgQSBxdWljayBmaXggaXMgdG9cbiAgICAgICAgICAgIC8vIGp1c3QgcmV2ZXJzZSB0aGUgYXJyYXkgYmVmb3JlIHdlIHJlbmRlciB0aGUgZWxlbWVudHMuXG4gICAgICAgICAgICBwYWdlRWxlbWVudC5pbnNlcnRCZWZvcmUoaGlnaGxpZ2h0RWxlbWVudCwgcGFnZUVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAT3ZlcnJpZGVcbiAgICAgKi9cbiAgICBwdWJsaWMgZGVzdHJveSgpIHtcblxuICAgICAgICBjb25zdCBzZWxlY3RvciA9IGAudGV4dC1oaWdobGlnaHQtJHt0aGlzLnRleHRIaWdobGlnaHQhLmlkfWA7XG4gICAgICAgIGNvbnN0IGhpZ2hsaWdodEVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG5cbiAgICAgICAgbG9nLmRlYnVnKGBGb3VuZCBOIGVsZW1lbnRzIGZvciBzZWxlY3RvciAke3NlbGVjdG9yfTogYCArIGhpZ2hsaWdodEVsZW1lbnRzLmxlbmd0aCk7XG5cbiAgICAgICAgaGlnaGxpZ2h0RWxlbWVudHMuZm9yRWFjaChoaWdobGlnaHRFbGVtZW50ID0+IHtcbiAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQucGFyZW50RWxlbWVudCEucmVtb3ZlQ2hpbGQoaGlnaGxpZ2h0RWxlbWVudCk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG59XG4iXX0=